#DRAGONES Y MAZMORRAS DATABASE SCRIPT

#DROP SCHEMA DMDB;
CREATE SCHEMA DMDB; 
USE DMDB;

#CREACION DE TABLAS

CREATE TABLE ESTADO(
    ESTADO_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    ESTADO_NOMBRE VARCHAR(50),
    ESTADO_MULTIPLICADOR_DANIO DOUBLE
);

CREATE TABLE TIPO (
    TIPO_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    TIPO_NOMBRE VARCHAR(50),
    TIPO_DANIO DOUBLE
);

CREATE TABLE EFECTO (
    EFECTO_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    EFECTO_NOMBRE VARCHAR(50),
    EFECTO_DANIO DOUBLE
);

CREATE TABLE COMPOSICION (
    COMPOSICION_EFECTO_ID BIGINT,
    COMPOSICION_COMPONENTE_ID BIGINT,
    PRIMARY KEY(COMPOSICION_EFECTO_ID, COMPOSICION_COMPONENTE_ID),
    FOREIGN KEY (COMPOSICION_EFECTO_ID) REFERENCES EFECTO(EFECTO_ID),
    FOREIGN KEY (COMPOSICION_COMPONENTE_ID) REFERENCES EFECTO(EFECTO_ID)
);

CREATE TABLE CLASE (
    CLASE_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    CLASE_NOMBRE VARCHAR(50),
    CLASE_DESCRIPCION VARCHAR(255),
    CLASE_MULT_RESISTENCIA DOUBLE
);

CREATE TABLE DIFICULTAD (
    DIFICULTAD_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    DIFICULTAD_NOMBRE VARCHAR(50)
);

CREATE TABLE ROL (
    ROL_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    ROL_NOMBRE VARCHAR(50)
);

CREATE TABLE REINO (
    REINO_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    REINO_NOMBRE VARCHAR(50)
);

CREATE TABLE REGION (
    REGION_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    REGION_REINO BIGINT,
    REGION_NOMBRE VARCHAR(50),
    FOREIGN KEY (REGION_REINO) REFERENCES REINO(REINO_ID)
);

CREATE TABLE MAZMORRA (
    MAZMORRA_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    MAZMORRA_REGION BIGINT,
    MAZMORRA_NOMBRE VARCHAR(50),
    FOREIGN KEY (MAZMORRA_REGION) REFERENCES REGION(REGION_ID)
);

CREATE TABLE ARMA (
    ARMA_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    ARMA_EFECTO BIGINT,
    ARMA_ESTADO BIGINT,
    ARMA_TIPO BIGINT,
    ARMA_NOMBRE VARCHAR(50),
    FOREIGN KEY (ARMA_EFECTO) REFERENCES EFECTO(EFECTO_ID),
    FOREIGN KEY (ARMA_ESTADO) REFERENCES ESTADO(ESTADO_ID),
    FOREIGN KEY (ARMA_TIPO) REFERENCES TIPO(TIPO_ID)
);

CREATE TABLE ENEMIGO(
    ENEMIGO_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    ENEMIGO_JEFE BIGINT,
    ENEMIGO_NOMBRE VARCHAR(50),
    ENEMIGO_VIDA_INICIAL DOUBLE,
    ENEMIGO_DANIO DOUBLE,
    ENEMIGO_CANT_EXPERIENCIA NUMERIC(10),
    FOREIGN KEY (ENEMIGO_JEFE) REFERENCES ENEMIGO(ENEMIGO_ID)
);

CREATE TABLE PERSONAJE(
    PERSONAJE_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    PERSONAJE_ARMA BIGINT,
    PERSONAJE_CLASE BIGINT,
    PERSONAJE_NOMBRE VARCHAR(50),
    PERSONAJE_VIDA_INICIAL DOUBLE,
    PERSONAJE_CANT_EXPERIENCIA DOUBLE,
    FOREIGN KEY (PERSONAJE_ARMA) REFERENCES ARMA(ARMA_ID),
    FOREIGN KEY (PERSONAJE_CLASE) REFERENCES CLASE(CLASE_ID)
);

CREATE TABLE MISION (
    MISION_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    MISION_ENEMIGO BIGINT,
    MISION_MAZMORRA BIGINT,
    MISION_DIFICULTAD BIGINT,
    MISION_NOMBRE VARCHAR(50),
    MISION_COMPLETADA BOOLEAN,
    FOREIGN KEY (MISION_ENEMIGO) REFERENCES ENEMIGO(ENEMIGO_ID),
    FOREIGN KEY (MISION_MAZMORRA) REFERENCES MAZMORRA(MAZMORRA_ID),
    FOREIGN KEY (MISION_DIFICULTAD) REFERENCES DIFICULTAD(DIFICULTAD_ID)
);

CREATE TABLE MIEMBRO (
    MIEMBRO_MISION BIGINT,
    MIEMBRO_PERSONAJE BIGINT,
    MIEMBRO_ROL BIGINT,
    PRIMARY KEY(MIEMBRO_MISION, MIEMBRO_PERSONAJE),
    FOREIGN KEY (MIEMBRO_MISION) REFERENCES MISION(MISION_ID),
    FOREIGN KEY (MIEMBRO_PERSONAJE) REFERENCES PERSONAJE(PERSONAJE_ID),
    FOREIGN KEY (MIEMBRO_ROL) REFERENCES ROL(ROL_ID)
);

#INSERCION DE TABLAS

INSERT INTO ESTADO (ESTADO_NOMBRE, ESTADO_MULTIPLICADOR_DANIO) VALUES
('Afilado', 1.25 ),
('Nuevo', 1 ),
('Oxidado', 0.5 ),
('Roto', 0.1 );

INSERT INTO TIPO (TIPO_NOMBRE, TIPO_DANIO) VALUES
('Espada', 100 ),
('Mazo', 150 ),
('Arco', 200 ),
('Varita', 500 ),
('Puños', 1 ),
('Laud', 10 );

INSERT INTO CLASE (CLASE_NOMBRE, CLASE_DESCRIPCION, CLASE_MULT_RESISTENCIA) VALUES
('Monje', 'Hace cosas de monje', 0.8 ),
('Paladin', 'Hace cosas de paladin', 0.7 ),
('Mago', 'Hace cosas de mago', 0.7 ),
('Bardo', 'Hace cosas de bardo', 0.6 ),
('Arquero', 'Hace cosas de arquero', 0.3 ),
('Guerrero', 'Hace cosas de guerrero', 0.5 );

INSERT INTO EFECTO (EFECTO_NOMBRE, EFECTO_DANIO) VALUES
('Fuego', 100 ),
('Hielo', 90 ),
('Veneno', 120 ),
('Electricidad', 150 ),
('Normal', 0 ),
('Magico', 200 ), 
('Envenenador Artico', 210),
('Llamarada Electrizante', 250);

INSERT INTO COMPOSICION (COMPOSICION_EFECTO_ID, COMPOSICION_COMPONENTE_ID) VALUES
(7, 2),
(7, 3),
(8, 1),
(8, 4);

INSERT INTO ROL (ROL_NOMBRE) VALUES
('Lider'),
('Soporte'),
('Combatiente');

INSERT INTO DIFICULTAD (DIFICULTAD_NOMBRE) VALUES
('Normal'),
('Dificil'),
('Pesadilla');

INSERT INTO REINO (REINO_NOMBRE) VALUES
('Reino Olvidado'),
('Reino Magico'),
('Reino Congelado');

INSERT INTO REGION (REGION_REINO, REGION_NOMBRE) VALUES
(1, 'Frontera Ardiente'),
(1, 'Tierras de la Discordia'),
(2, 'Norte Helado'),
(2, 'Sur Abrasador'),
(3, 'Occidente Salvaje'),
(3, 'Este Misterioso');

INSERT INTO MAZMORRA (MAZMORRA_REGION, MAZMORRA_NOMBRE) VALUES
(1, 'Cripta de las Almas Antiguas'),
(2, 'Abismo de las Pesadillas Oscuras'),
(3, 'Cárcel de los Condenados Eternos'),
(4, 'Foso de la Desolación Profunda'),
(5, 'Mazmorra del Susurro Maldito'),
(6, 'Catacumbas del Olvido Eterno'),
(1, 'Gruta de los Lamentos Olvidados'),
(2, 'Caverna del Caos Perdido'),
(3, 'Fauces de la Oscuridad Infinita'),
(4, 'Abismo de la Desesperanza'),
(5, 'Catacumbas del Terror Oscuro'),
(6, 'Túneles del Abandono'),
(1, 'Guarida del Dragón Ancestral'),
(2, 'Cámaras del Horror Eterno'),
(3, 'Abismo de la Perdición Infinita'),
(4, 'Fauces de la Desesperación'),
(5, 'Sala de los Lamentos Abandonados'),
(6, 'Profundidades del Caos Infernal'),
(5, 'Gruta de los Susurros Siniestros'),
(6, 'Foso de la Desesperación');

INSERT INTO ARMA (ARMA_EFECTO, ARMA_ESTADO, ARMA_TIPO, ARMA_NOMBRE) VALUES
(1, 1, 1, 'Espada de Fuego'),
(2, 2, 2, 'Mazo de Hielo'),
(3, 3, 3, 'Arco Venenoso'),
(4, 4, 4, 'Varita Eléctrica'),
(8, 1, 5, 'Puños Envenenadores Articos'),
(6, 2, 6, 'Laud Mágico');

INSERT INTO ENEMIGO (ENEMIGO_JEFE, ENEMIGO_NOMBRE, ENEMIGO_VIDA_INICIAL, ENEMIGO_DANIO, ENEMIGO_CANT_EXPERIENCIA) VALUES
(NULL, 'Dragón', 500, 100, 1000),
(1, 'Orco', 100, 20, 200),
(1, 'Troll', 150, 30, 300),
(2, 'Goblin', 50, 10, 100),
(2, 'Esqueleto', 70, 15, 150);

INSERT INTO PERSONAJE (PERSONAJE_ARMA, PERSONAJE_CLASE, PERSONAJE_NOMBRE, PERSONAJE_VIDA_INICIAL, PERSONAJE_CANT_EXPERIENCIA) VALUES
(1, 1, 'Eldarian', 200, 0),
(2, 4, 'Aria', 180, 0),
(3, 5, 'Thalgar', 220, 0),
(4, 3, 'Merlin', 150, 0),
(5, 2, 'Falkor', 250, 0);

INSERT INTO MISION (MISION_ENEMIGO, MISION_MAZMORRA, MISION_DIFICULTAD, MISION_NOMBRE, MISION_COMPLETADA) VALUES
(4, 1, 1, 'Limpiar la Mazmorra del Goblin', FALSE),
(5, 2, 2, 'Recuperar el Tesoro del Esqueleto', FALSE),
(2, 3, 3, 'Derrotar al Orco Líder', FALSE),
(3, 4, 2, 'Investigar la Cueva del Troll', FALSE),
(1, 5, 3, 'Vencer al Dragón en su Guarida', FALSE);

INSERT INTO MIEMBRO (MIEMBRO_MISION, MIEMBRO_PERSONAJE, MIEMBRO_ROL) VALUES
(1, 1, 1),
(1, 2, 2),
(2, 3, 1),
(2, 4, 2),
(3, 5, 1),
(4, 1, 1),
(4, 2, 2),
(5, 3, 1),
(5, 4, 2),
(5, 5, 1);

#VER MAZMORRA EN QUE REINO Y REGION ESTA (UBICACION)
SELECT MAZ.MAZMORRA_ID, MAZ.MAZMORRA_NOMBRE, REG.REGION_ID, REG.REGION_NOMBRE, REI.REINO_ID, REI.REINO_NOMBRE FROM MAZMORRA MAZ 
JOIN REGION REG ON MAZ.MAZMORRA_REGION = REG.REGION_ID 
JOIN REINO REI ON REG.REGION_REINO = REI.REINO_ID;

#EJEMPLO DE CALCULO DE DESNORMALIZACION 
SELECT COMPOSICION_EFECTO_ID,E2.EFECTO_NOMBRE, SUM(E1.EFECTO_DANIO) FROM COMPOSICION 
JOIN EFECTO E1 ON E1.EFECTO_ID = COMPOSICION_COMPONENTE_ID 
JOIN EFECTO E2 ON COMPOSICION_EFECTO_ID = E2.EFECTO_ID
GROUP BY COMPOSICION_EFECTO_ID, E2.EFECTO_NOMBRE
